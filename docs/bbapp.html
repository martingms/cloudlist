<!DOCTYPE html>  <html> <head>   <title>bbapp.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               bbapp.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>bbapp.js
(c) 2011 Martin Gammels√¶ter
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>A global object for storing all kinds of settings. If possible all configuration should be done here.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">settings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">sc_consumer_key</span>  <span class="o">:</span> <span class="s1">&#39;768e41058531333626dd3e913010661a&#39;</span><span class="p">,</span>
  <span class="nx">yt_developer_key</span> <span class="o">:</span> <span class="s1">&#39;AI39si6wOs6S58ih1SeRvHNLVtkzXVSO0xHIjy7Au3kuzXEr3yqYUVduuKfxvErG7VJkcL_Q9X1FIhcj42cfVbW6EwDLBIVrBA&#39;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>soundmanager2 default settings. </p>

<ul>
<li><strong>TODO</strong> Move this somewhere else.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">soundManager</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;/static/swf/&#39;</span><span class="p">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">flashVersion</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">useFlashBlock</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">useHighPerformance</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">wmode</span> <span class="o">=</span> <span class="s1">&#39;transparent&#39;</span><span class="p">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">useFastPolling</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Track model</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Track</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>initialize</code> - Called on initialization of a new track.</p>

<ul>
<li><strong>TODO</strong> Add to current playlists 'tracks' attribute</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Getting the hostname from an inputted url. getHostname() is defined in utils.js</p>

<pre><code>'http://soundcloud.com/artist/track'.getHostname();
  returns: 'soundcloud.com'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">).</span><span class="nx">getHostname</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Chooses which function to use for fetching track info based on link hostname.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">switch</span> <span class="p">(</span><span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;soundcloud.com&#39;</span><span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">getScTrackInfo</span><span class="p">();</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;youtube.com&#39;</span><span class="p">,</span> <span class="s1">&#39;www.youtube.com&#39;</span><span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span> <span class="nx">ytid</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">).</span><span class="nx">getYtVideoId</span><span class="p">()</span> <span class="p">});</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">getYtTrackInfo</span><span class="p">();</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>getScTrackInfo</code> - Called by Track.initialize if new track url hostname is <em>souncloud.com</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getScTrackInfo</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Here, <em>this</em> refers to the model in question. This reference is saved to the variable <em>that</em> to avoid losing the reference deeper in the function.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">apiurl</span> <span class="o">=</span> <span class="s1">&#39;http://api.soundcloud.com/resolve?url=&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;format=json&amp;consumer_key=&#39;</span><span class="o">+</span><span class="nx">settings</span><span class="p">.</span><span class="nx">sc_consumer_key</span><span class="o">+</span><span class="s1">&#39;&amp;callback=?&#39;</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">apiurl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scdata</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>What <em>scdata</em> contains can be seen <a href="http://developers.soundcloud.com/docs/api/tracks">here</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">that</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><em>type</em> is set so the player can determine how to play the track.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">type</span>        <span class="o">:</span> <span class="s1">&#39;sc&#39;</span><span class="p">,</span>
          <span class="nx">title</span>       <span class="o">:</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
          <span class="nx">artworkurl</span>  <span class="o">:</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">artwork_url</span><span class="p">,</span>
          <span class="nx">downloadurl</span> <span class="o">:</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">download_url</span><span class="p">,</span>
          <span class="nx">user</span>        <span class="o">:</span> <span class="p">{</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">userurl</span><span class="o">:</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">permalink_url</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Duration is returned in milliseconds, for now this is changed on the fly to the more common <em>mm:ss</em> format.</p>

<ul>
<li><strong>TODO</strong> Make it return <em>hh:mm:ss</em> if the duration is greater than one hour.</li>
<li><strong>TODO</strong> Also have a redundant duration in milliseconds, if it is needed by the progress bar.</li>
<li><strong>TODO</strong> Move duration function to utils.js, taking ms or s or m or whatever as second argument.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">duration</span>    <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">60</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">floormin</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">minutes</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">seconds</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">minutes</span> <span class="o">-</span> <span class="nx">floormin</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">seconds</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">seconds</span> <span class="o">=</span> <span class="nx">seconds</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">floormin</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">seconds</span><span class="p">;</span>
          <span class="p">}(),</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>If title has greater than 50 characters, make a short version that is truncated at 47 and ends with ellipsis to signify that it is truncated.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">shorttitle</span>  <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">scdata</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">47</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;...&#39;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}(),</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Creates a soundmanager2 sound for the track, so it can be easily played on demand.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">sound</span>       <span class="o">:</span> <span class="nx">soundManager</span><span class="p">.</span><span class="nx">createSound</span><span class="p">({</span>
            <span class="nx">id</span>  <span class="o">:</span> <span class="s1">&#39;track_&#39;</span> <span class="o">+</span> <span class="nx">that</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="nx">url</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">scdata</span><span class="p">.</span><span class="nx">stream_url</span><span class="p">;</span>
              <span class="nx">url</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;secret_token&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">:</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">;</span>
              <span class="k">return</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;consumer_key=&#39;</span> <span class="o">+</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">sc_consumer_key</span><span class="p">;</span>
            <span class="p">}(),</span>
            <span class="nx">onfinish</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="nx">that</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;trackFinished&#39;</span><span class="p">,</span> <span class="nx">that</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">})</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>getYtTrackInfo</code> - Called by Track.initialize if new track url hostname is <em>youtube.com</em>.</p>

<ul>
<li><strong>TODO</strong> Write the function.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getYtTrackInfo</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">apiurl</span> <span class="o">=</span> <span class="s1">&#39;https://gdata.youtube.com/feeds/api/videos/&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;ytid&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;?alt=json&#39;</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span>        <span class="o">:</span> <span class="nx">apiurl</span><span class="p">,</span>
        <span class="nx">dataType</span>   <span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span><span class="p">,</span>
        <span class="nx">beforeSend</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">jqXHR</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;GData-Version&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="nx">jqXHR</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;X-GData-Key&#39;</span><span class="p">,</span> <span class="s1">&#39;key=&#39;</span><span class="o">+</span><span class="nx">settings</span><span class="p">.</span><span class="nx">yt_developer_key</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">success</span>    <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ytdata</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>What <em>ytdata</em> contains can be tried out with youtube's interactive <a href="http://gdata.youtube.com/demo/index.html">demo</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">that</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
            <span class="nx">type</span>       <span class="o">:</span> <span class="s1">&#39;yt&#39;</span><span class="p">,</span>
            <span class="nx">title</span>      <span class="o">:</span> <span class="nx">ytdata</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">$t</span><span class="p">,</span>
            <span class="nx">artworkurl</span> <span class="o">:</span> <span class="nx">ytdata</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">media$group</span><span class="p">.</span><span class="nx">media$thumbnail</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">url</span><span class="p">,</span>
            <span class="nx">user</span>       <span class="o">:</span> <span class="p">{</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">ytdata</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">author</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">.</span><span class="nx">$t</span><span class="p">,</span> <span class="nx">userurl</span><span class="o">:</span> <span class="nx">ytdata</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">author</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">uri</span><span class="p">.</span><span class="nx">$t</span> <span class="p">},</span>
            <span class="nx">duration</span>   <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">totalSeconds</span> <span class="o">=</span> <span class="nx">ytdata</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">media$group</span><span class="p">.</span><span class="nx">yt$duration</span><span class="p">.</span><span class="nx">seconds</span><span class="p">;</span>
              <span class="kd">var</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">totalSeconds</span> <span class="o">/</span> <span class="mi">60</span><span class="p">);</span>
              <span class="kd">var</span> <span class="nx">seconds</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(((</span><span class="nx">totalSeconds</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span><span class="o">-</span><span class="nx">minutes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">seconds</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">seconds</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">seconds</span><span class="p">;</span>
              <span class="k">return</span> <span class="nx">minutes</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">seconds</span><span class="p">;</span>
            <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>TODO shorten title if > 50 chars</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">shorttitle</span> <span class="o">:</span> <span class="nx">ytdata</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">$t</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">playpause</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;sc&#39;</span><span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sound&#39;</span><span class="p">).</span><span class="nx">togglePause</span><span class="p">();</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;yt&#39;</span><span class="o">:</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">ytplayer</span><span class="p">.</span><span class="nx">getPlayerState</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">-</span><span class="mi">1</span><span class="o">:</span>
              <span class="nx">ytplayer</span><span class="p">.</span><span class="nx">loadVideoById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;ytid&#39;</span><span class="p">));</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
              <span class="nx">ytplayer</span><span class="p">.</span><span class="nx">playVideo</span><span class="p">();</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
              <span class="nx">ytplayer</span><span class="p">.</span><span class="nx">pauseVideo</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">play</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">soundManager</span><span class="p">.</span><span class="nx">stopAll</span><span class="p">();</span>
      <span class="nx">ytplayer</span><span class="p">.</span><span class="nx">stopVideo</span><span class="p">();</span>
      <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;sc&#39;</span><span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sound&#39;</span><span class="p">).</span><span class="nx">play</span><span class="p">();</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;yt&#39;</span><span class="o">:</span>
          <span class="nx">ytplayer</span><span class="p">.</span><span class="nx">loadVideoById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;ytid&#39;</span><span class="p">));</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">restartTrack</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">soundManager</span><span class="p">.</span><span class="nx">stopAll</span><span class="p">();</span>
      <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;sc&#39;</span><span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sound&#39;</span><span class="p">).</span><span class="nx">play</span><span class="p">();</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;yt&#39;</span><span class="o">:</span>
          <span class="nx">ytplayer</span><span class="p">.</span><span class="nx">seekTo</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Playlist model</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The playlist model uses an extension of the standard Backbone.Model; <a href="https://github.com/PaulUithol/Backbone-relational">Backbone-relational</a>.
Backbone-relational is used to emulate a relational relationship akin to those in a normal relational database.</p>

<ul>
<li><strong>TODO</strong> This model is not used yet. Will need some writing.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Playlist</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">RelationalModel</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

    <span class="nx">relations</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">type</span> <span class="o">:</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">HasMany</span><span class="p">,</span>
        <span class="nx">key</span>  <span class="o">:</span> <span class="s1">&#39;tracks&#39;</span><span class="p">,</span>
        <span class="nx">relatedModel</span> <span class="o">:</span> <span class="s1">&#39;Track&#39;</span>
      <span class="p">}</span>
    <span class="p">]</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>TrackList collection</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>A collection of tracks as showed in the UI. _Note that the <code>TrackList</code> collection should not be mixed up
with the <code>Playlist</code> model, as they represent different things. Currently, the only thing defined for this
collection is the model which it referes to (<code>Track</code>), and at what url requests should be made.</p>

<ul>
<li><strong>TODO</strong> Explain better the difference.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">TrackList</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

    <span class="nx">model</span><span class="o">:</span> <span class="nx">Track</span><span class="p">,</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/ajax/tracks&#39;</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>PlaylistList collection</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>A collection of playlists.</p>

<ul>
<li><strong>TODO</strong> Write more documentation on use, when this starts to get used.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">PlaylistList</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

    <span class="nx">model</span><span class="o">:</span> <span class="nx">Playlist</span><span class="p">,</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/ajax/playlists&#39;</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h2>TrackView</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>The view for a single track in the tracklist.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">TrackView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>The tag to encapsulate an instance of the view.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">tagName</span><span class="o">:</span> <span class="s1">&#39;li&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>The class name of the encapsulating tag.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;track&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>The template for the track. This is currently defined in the index jinja2 template.</p>

<ul>
<li><strong>TODO</strong> Make all templates separate files, and include them in some other way.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">template</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#track-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span>

    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;dblclick&#39;</span> <span class="o">:</span> <span class="s1">&#39;gotoTrack&#39;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>When a new instance of TrackView is initialized:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;render&#39;</span><span class="p">,</span> <span class="s1">&#39;togglePlaying&#39;</span><span class="p">,</span> <span class="s1">&#39;gotoTrack&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Bind the <em>change</em> event so that every time a change occurs on the corresponding track, call the render function.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Give the track a reference to its view for convenience.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Using <a href="https://github.com/janl/mustache.js">mustache.js</a> for templating. This forces logic out of the templates pretty well.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span> <span class="c1">// Show a spinner before title is loaded</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Returning <em>this</em> (the model instance) to make chaining possible.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">togglePlaying</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;playing&#39;</span><span class="p">);</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">removePlaying</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;playing&#39;</span><span class="p">);</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">gotoTrack</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;gotoTrack&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h2>PlayerView</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>The view for the player itself.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">PlayerView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The <code>div</code> element this view should populate.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#player&#39;</span><span class="p">),</span>

    <span class="nx">template</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#player-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span>

    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;click #play&#39;</span>               <span class="o">:</span> <span class="s1">&#39;playpause&#39;</span><span class="p">,</span>
      <span class="s1">&#39;click #pause&#39;</span>              <span class="o">:</span> <span class="s1">&#39;playpause&#39;</span><span class="p">,</span>
      <span class="s1">&#39;click #next&#39;</span>               <span class="o">:</span> <span class="s1">&#39;skipToNextTrack&#39;</span><span class="p">,</span>
      <span class="s1">&#39;click #previous&#39;</span>           <span class="o">:</span> <span class="s1">&#39;restartTrack&#39;</span><span class="p">,</span>
      <span class="s1">&#39;dblclick #previous&#39;</span>        <span class="o">:</span> <span class="s1">&#39;skipToPrevTrack&#39;</span><span class="p">,</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Fetching the ytplayer element with getElementById because jQuery wraps the element so that
playback functions won't work.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;render&#39;</span><span class="p">,</span> <span class="s1">&#39;playpause&#39;</span><span class="p">,</span> <span class="s1">&#39;skipToNextTrack&#39;</span><span class="p">,</span> <span class="s1">&#39;gotoTrack&#39;</span><span class="p">,</span> <span class="s1">&#39;onYtPlayerStateChange&#39;</span><span class="p">,</span> <span class="s1">&#39;onTrackFinished&#39;</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">globalEvents</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;ytPlayerStateChange&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onYtPlayerStateChange</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;trackFinished&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onTrackFinished</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;gotoTrack&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">gotoTrack</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p><em>nextTrack</em> should always point to the next track to be played unless there is any skipping etc.
At initialization, this is the first track in the collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><code>playpause</code> - Does what it says on the tin, triggered when play or pause button on player is pressed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">playpause</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">playpause</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#play, #pause&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">togglePlaying</span><span class="p">();</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p><code>skipToNextTrack</code> - Skips ahead to the next track in the list. Called when the next-button is pressed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">skipToNextTrack</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Remove class <em>playing</em> from current track.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">removePlaying</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">last</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">togglePlaying</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#play, #pause&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><code>skipToPrevTrack</code> - Skips back to the previous track in the list. Called when the previous-button is doubleclicked.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">skipToPrevTrack</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">removePlaying</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">first</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">last</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">togglePlaying</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#play, #pause&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><code>restartTrack</code> - Restarts the current track. Called when the previous-button is pressed once.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">restartTrack</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">restartTrack</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">gotoTrack</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">track</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">removePlaying</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="nx">track</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">togglePlaying</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#play, #pause&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">onYtPlayerStateChange</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Track ended</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">onTrackFinished</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">onTrackFinished</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">track</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">track</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">removePlaying</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>TODO if last track, goto first</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">last</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">track</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextTrack</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">togglePlaying</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#play, #pause&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <h2>TracklistView</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>The view for the whole tracklist. Renders one <em>collection of tracks</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">TracklistView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tracklist&#39;</span><span class="p">),</span>

    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;click #add&#39;</span>                <span class="o">:</span> <span class="s1">&#39;showInput&#39;</span><span class="p">,</span>
      <span class="s1">&#39;keypress #add-track-input&#39;</span> <span class="o">:</span> <span class="s1">&#39;addTrackOnEnter&#39;</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;render&#39;</span><span class="p">,</span> <span class="s1">&#39;addTrackOnEnter&#39;</span><span class="p">,</span> <span class="s1">&#39;showInput&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p><em>input</em> is set to be the (hidden) text input field.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">input</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add-track-input&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Creating an instance of a <em>TrackList</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TrackList</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>If a <em>Track</em> is added to the colllection, call <code>appendTrack</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">appendTrack</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>If fetch from server was successful...</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Append each track to TracklistView with <code>appendTrack</code>.</p>

<ul>
<li><strong>TODO</strong> There is probably a better way to do this, perhaps through a template that renders a whole collection.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">track</span> <span class="k">in</span> <span class="nx">that</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">appendTrack</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">[</span><span class="nx">track</span><span class="p">]);</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Also, create a new <code>PlayerView</code> with the fetched collection as input.
That view now handles all playback of the current tracklist.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">this</span><span class="p">.</span><span class="nx">playerview</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PlayerView</span><span class="p">({</span> <span class="nx">collection</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">collection</span> <span class="p">});</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>If fetch from server was erroneous...</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Raise an error with a meaningful message.</p>

<ul>
<li><strong>TODO</strong> Create a view for errors, that shows them conveniently in the DOM.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Something went wrong! This was the response: &#39;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>

    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>This view does not actually call the <code>render</code>-function ever.</p>

<ul>
<li><strong>TODO</strong> Maybe most of the functionality of this view should be moved to a router?</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p><code>appendTrack</code> - Creates a new <em>TrackView</em> for every added track, and appends it to the DOM.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">appendTrack</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">track</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TrackView</span><span class="p">({</span> <span class="nx">model</span><span class="o">:</span> <span class="nx">track</span> <span class="p">});</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;ol.tracks&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p><code>addTrackOnEnter</code> - Called every time a key is pressed while the <em>input</em>-field is in focus.</p>

<ul>
<li><strong>TODO</strong> Add some validation on url.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">addTrackOnEnter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>If the key is not enter (keycode 13), just return the function.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">!=</span> <span class="mi">13</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Else, create a new <em>Track</em> through the collections build in <code>create</code> method.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>If the newly added track is the first in the collection, initialize the player again.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">playerview</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">playerview</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Reset the input value to the empty string and fade out the field upon completion.</p>

<ul>
<li><strong>TODO</strong> Only do this if adding of track is successful, if not show a descriptive error message.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">showInput</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">fadeToggle</span><span class="p">();</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <h2>Kicking it all off</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>When soundmanager2 is loaded, start the entire app by creating a new <em>TrackListView</em>.</p>

<ul>
<li><strong>FIXME</strong> Chaining <em>onready</em>s is rather ugly.</li>
<li><strong>TODO</strong> Start the app through a router instead of a view.</li>
<li><strong>TODO</strong> Start history once pushState urls is implemented.</li>
<li><strong>TODO</strong> Also check if ytplayer is ready through creating <code>onYouTubePlayerReady()</code></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">soundManager</span><span class="p">.</span><span class="nx">onready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">Tracklist</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TracklistView</span><span class="p">();</span>
  <span class="p">});</span>

<span class="p">});</span>

<span class="kd">var</span> <span class="nx">globalEvents</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">globalEvents</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">ytPlayerStateChange</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">globalEvents</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;ytPlayerStateChange&#39;</span><span class="p">,</span> <span class="nx">newState</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">onYouTubePlayerReady</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">ytplayer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;onStateChange&#39;</span><span class="p">,</span> <span class="s1">&#39;ytPlayerStateChange&#39;</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 